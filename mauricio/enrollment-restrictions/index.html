



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Aggregated Medicare documentation in a single place">
      
      
        <link rel="canonical" href="https://kylebarron.github.io/medicare-documentation/mauricio/enrollment-restrictions/">
      
      
        <meta name="author" content="Kyle Barron">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.0">
    
    
      
        <title>Enrollment Restrictions - Medicare Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.aa3de92b.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,700|Fira+Code">
        <style>body,input{font-family:"Nunito Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="orange" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#enrollment-restrictions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://kylebarron.github.io/medicare-documentation/" title="Medicare Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon">local_library</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Medicare Documentation
              </span>
              <span class="md-header-nav__topic">
                Enrollment Restrictions
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/kylebarron/medicare-documentation/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      medicare-documentation
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../NBER_website/1_Overview/" title="NBER Documentation" class="md-tabs__link">
          NBER Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../resdac/mbsf/" title="ResDAC Documentation" class="md-tabs__link">
          ResDAC Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../kyle/goals-for-modern-data-format/" title="Working with the Data" class="md-tabs__link">
          Working with the Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" title="Important Details" class="md-tabs__link md-tabs__link--active">
          Important Details
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon">local_library</i>
      
    </span>
    Medicare Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/kylebarron/medicare-documentation/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      medicare-documentation
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      NBER Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        NBER Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/1_Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/2_Background/" title="Description of Claims Files" class="md-nav__link">
      Description of Claims Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/3_Getting_started_with_SAS/" title="Getting Started with SAS" class="md-nav__link">
      Getting Started with SAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/4_constructing_extracts/" title="Constructing Extracts with SAS" class="md-nav__link">
      Constructing Extracts with SAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/5_manipulating_medicare_extracts/" title="Manipulating Extracts with SAS" class="md-nav__link">
      Manipulating Extracts with SAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/6_costs/" title="Generating Costs Measures" class="md-nav__link">
      Generating Costs Measures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/7_references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/8_appendix/" title="Appendix" class="md-nav__link">
      Appendix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">
    
    <label class="md-nav__link" for="nav-2-9">
      Variable Names Crosswalk
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        Variable Names Crosswalk
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../NBER_website/opxw/" title="Outpatient" class="md-nav__link">
      Outpatient
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ResDAC Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ResDAC Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/mbsf/" title="Beneficiary Summary File" class="md-nav__link">
      Beneficiary Summary File
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/carrier-rif/" title="Carrier RIF" class="md-nav__link">
      Carrier RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/denominator-rif/" title="Denominator RIF" class="md-nav__link">
      Denominator RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/dme-rif/" title="Durable Medical Equipment RIF" class="md-nav__link">
      Durable Medical Equipment RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/hha-rif/" title="Home Health Agency RIF" class="md-nav__link">
      Home Health Agency RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/hospice-rif/" title="Hospice RIF" class="md-nav__link">
      Hospice RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/ip-rif/" title="Inpatient RIF" class="md-nav__link">
      Inpatient RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/medpar-rif/" title="MedPAR RIF" class="md-nav__link">
      MedPAR RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/op-rif/" title="Outpatient RIF" class="md-nav__link">
      Outpatient RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/snf-rif/" title="Skilled Nursing Facility RIF" class="md-nav__link">
      Skilled Nursing Facility RIF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../resdac/variables/" title="Variable Definitions" class="md-nav__link">
      Variable Definitions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Working with the Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Working with the Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kyle/goals-for-modern-data-format/" title="Goals for New Data Format" class="md-nav__link">
      Goals for New Data Format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kyle/01medicare_readme/" title="Standard Readme" class="md-nav__link">
      Standard Readme
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kyle/extract_data/" title="Data Extraction Overview" class="md-nav__link">
      Data Extraction Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kyle/data_locations/" title="Data Locations" class="md-nav__link">
      Data Locations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kyle/using-tmux-aging-servers/" title="Using tmux for long-running jobs" class="md-nav__link">
      Using tmux for long-running jobs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Important Details
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Important Details
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Enrollment Restrictions
      </label>
    
    <a href="./" title="Enrollment Restrictions" class="md-nav__link md-nav__link--active">
      Enrollment Restrictions
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-layout" title="File Layout" class="md-nav__link">
    File Layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-example" title="Code Example" class="md-nav__link">
    Code Example
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lag-post-event-spending/" title="Calculating Costs for Inpatient Visits" class="md-nav__link">
      Calculating Costs for Inpatient Visits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-layout" title="File Layout" class="md-nav__link">
    File Layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-example" title="Code Example" class="md-nav__link">
    Code Example
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kylebarron/medicare-documentation/blob/master/docs/mauricio/enrollment-restrictions.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="enrollment-restrictions">Enrollment Restrictions<a class="headerlink" href="#enrollment-restrictions" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document was originally written by <a href="https://mcaceresb.github.io/">Mauricio Cáceres</a>.</p>
</div>
<p>The denominator file is so named because it can give you, for a given
point in time, the denominator for your query. That is, it can tell you
all the patients that could plausibly be included in your query (at least
that is my understanding of it).</p>
<p>Hence the denominator file is comprehensive and contains records for all
patients eligible for Medicare until the date of their death. Naturally,
not every patient in the denominator file will be enrolled in all parts
of Medicare every month they are present. The denominator file contains
variables that help determine enrollment and continuous enrollment in
Medicare.</p>
<h2 id="file-layout">File Layout<a class="headerlink" href="#file-layout" title="Permanent link">&para;</a></h2>
<p>The file layout is wide. Each row is a beneficiary and most of the
columns are categorical variables for each month of the denominator
file. They are named</p>
<ul>
<li><code>hmoind[Year]m[Month]</code></li>
<li><code>buyin[Year]m[Month]</code></li>
</ul>
<p>For example, <code>hmoind2008m8</code> or <code>buyin1999m12</code>. These variables take on
the values:</p>
<table>
<thead>
<tr>
<th align="left">HMO Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">Not a member of HMO</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">Non lock-in, HCFA to process provider claims</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Non lock-in, GHO to process in-plan Part A and in-area Part B claims</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">FFS for disease management demonstration project (2005 forward)</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">Lock-in, HCFA to process provider claims</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">Lock-in, GHO to process in Plan part A and in-area Part B claims</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">Lock-in, GHO to process all provider claims</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="left">Buy-in Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">Not entitled</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">Part A only</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Part B only</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Part A and Part B</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">Part A, state buy-in</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">Part B, state buy-in</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">Part A and Part B, state buy-in</td>
</tr>
</tbody>
</table>
<p>Typically, we are looking for <em>continuously enrolled</em> patients. That is,
patients who were enrolled every month pre/post a particular event for a
certain window of time. We usually say a patient is enrolled if</p>
<ul>
<li>HMO is <code>0</code> or <code>4</code></li>
<li>Buy-in is <code>3</code> or <code>C</code></li>
</ul>
<p>The code to run this can be adapted from Maurice's SAS code in
<code>SASMacros/generateEnrollRest.sas</code>. The idea is as follows:</p>
<ul>
<li>Select the start and end dates for the enrollment restrictions check (e.g. check restrictions from Jan 1999 to Dec 2008).</li>
<li>Index the first month to 1 and the last month to <code>[month range]</code> (e.g. Jan 1999 is 1, Dec 2008 is 120).</li>
<li>Find the relative month of the index event (e.g. if the event happened January 2004, the month would be 73).</li>
<li>Determine the date of death of the beneficiary. If missing, we assume the person is alive.</li>
<li>Determine the number of months pre/post the event to check (e.g. 12).</li>
</ul>
<p>Now that the program is set up, we aim to generate an HMO indicator
and a buy-in indicator based on the values specified in the table above.</p>
<ul>
<li>If the index event occurred before the start date or after the end date, set both HMO and buy-in indicators to <code>0</code>.</li>
<li>If the index event occurred within the window of time to check, then loop from <code>[relative event month - months before]</code> through <code>[relative event month + months after]</code> and check whether the HMO and buy-in indicators for those months.</li>
<li>
<p>For diseased individuals, stop the search at <code>min(relative event month + months after, relative death month)</code></p>
</li>
<li>
<p>Set HMO for that month to <code>1</code> if <code>0</code> or <code>4</code>; <code>0</code> otherwise.</p>
</li>
<li>Set buy-in for that month to <code>1</code> if <code>3</code> or <code>C</code>; <code>0</code> otherwise.</li>
<li>Set HMO to <code>1</code> if HMO for each month was <code>1</code>; <code>0</code> otherwise.</li>
<li>Set buy-in to <code>1</code> if buy-in for each month was <code>1</code>; <code>0</code> otherwise.</li>
</ul>
<h2 id="code-example">Code Example<a class="headerlink" href="#code-example" title="Permanent link">&para;</a></h2>
<p>The CMS Specialists project has a very simple version of this
code available: It takes a date variable, which is assumed
to contain the event dates, and applies the algorithm above:</p>
<div class="codehilite"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Example:</span>
<span class="cm"> * %generateEnrollRest(admission_date, 1998, 2012, 12, 12, 12, 12);</span>
<span class="cm"> */</span>
<span class="nb">%macro</span> generateEnrollRest(
        dtvar,        <span class="c">/* Base date for enrollment restriction         */</span>
        <span class="k">end</span>,          <span class="c">/* Stop checking enrollment after &amp;end year     */</span>
        start,        <span class="c">/* Start checking enrollment at &amp;start year     */</span>
        FFSmonthpost, <span class="c">/* Months to check FFS enrollment after &amp;dtvar  */</span>
        HMOmonthpost, <span class="c">/* Months to check HMO enrollment after &amp;dtvar  */</span>
        FFSmonthpre,  <span class="c">/* Months to check FFS enrollment before &amp;dtvar */</span>
        HMOmonthpre   <span class="c">/* Months to check HMO enrollment before &amp;dtvar */</span>
    );

    <span class="cm">/*</span>
<span class="cm">     * Set up arrays to work with enrollment variables; %genYM() is</span>
<span class="cm">     * a untility macro to print the names of the HMO and buy-in</span>
<span class="cm">     * variables, since they area formatted in an awkward way</span>
<span class="cm">     */</span>
    <span class="k">array</span> affs{<span class="nb">%eval</span>(<span class="m">12</span> * (<span class="nv">&amp;end.</span> - <span class="nv">&amp;start.</span> + <span class="m">1</span>))} <span class="nf">%genYM</span>(buyin,  <span class="nv">&amp;start.</span>, <span class="nv">&amp;end.</span>, month);
    <span class="k">array</span> ahmo{<span class="nb">%eval</span>(<span class="m">12</span> * (<span class="nv">&amp;end.</span> - <span class="nv">&amp;start.</span> + <span class="m">1</span>))} <span class="nf">%genYM</span>(hmoind, <span class="nv">&amp;start.</span>, <span class="nv">&amp;end.</span>, month);

    <span class="cm">/*</span>
<span class="cm">     * diagmonth is the month number of the indx event. Its the origin</span>
<span class="cm">     * around which enrollment will be defined. As defined by the above</span>
<span class="cm">     * arrays its a frunction of your start and end date</span>
<span class="cm">     */</span>
    diagmonth = (<span class="nb">year(</span><span class="nv">&amp;dtvar.</span>) - <span class="nv">&amp;start.</span>) * <span class="m">12</span> + <span class="nb">month(</span><span class="nv">&amp;dtvar.</span>);

    <span class="cm">/***************</span>
<span class="cm">     *  Pre-Check  *</span>
<span class="cm">     ***************/</span>

<span class="c">    * If event before start, all indicators to 0;</span>
    <span class="k">if</span> (<span class="nb">year(</span><span class="nv">&amp;dtvar.</span>) &lt; <span class="nv">&amp;start.</span>) <span class="k">then</span> <span class="k">do</span>;
        eHMO_pre = <span class="m">0</span>;
        eFFS_pre = <span class="m">0</span>;
        <span class="k">end</span>;
    <span class="k">else</span> <span class="k">do</span>;
<span class="c">        * Otherwise start the loop for months pre;</span>
        eHMO_pre = <span class="m">1</span>;
        eFFS_pre = <span class="m">1</span>;

<span class="c">        * Check endpoints of window are inside the window being studied;</span>
        <span class="k">if</span> diagmonth - <span class="nv">&amp;FFSmonthpre.</span> &gt; <span class="m">0</span> <span class="k">then</span> <span class="k">do</span>;
            <span class="k">do</span> m = diagmonth - <span class="nv">&amp;FFSmonthpre.</span> to diagmonth;
                eFFS_pre = eFFS_pre <span class="k">and</span> (affs(m) = <span class="s">&quot;3&quot;</span> <span class="k">or</span> affs(m) = <span class="s">&quot;C&quot;</span>);
            <span class="k">end</span>;
        <span class="k">end</span>;

        <span class="k">if</span> diagmonth - <span class="nv">&amp;HMOmonthpre.</span> &gt; <span class="m">0</span> <span class="k">then</span> <span class="k">do</span>;
            <span class="k">do</span> m = diagmonth - <span class="nv">&amp;HMOmonthpre.</span> to diagmonth;
                eHMO_pre = eHMO_pre <span class="k">and</span> (ahmo(m) = <span class="s">&quot;0&quot;</span> <span class="k">or</span> ahmo(m) = <span class="s">&quot;4&quot;</span>);
            <span class="k">end</span>;
        <span class="k">end</span>;

<span class="c">        * If element cannot be checked in study window, no cont enrollment;</span>
        <span class="k">if</span> diagmonth - <span class="nv">&amp;FFSmonthpre.</span> &lt;= <span class="m">0</span> <span class="k">then</span> <span class="k">do</span>;
            eFFS_pre = <span class="m">0</span> ;
        <span class="k">end</span>;

<span class="c">        * If element cannot be checked in study window, no cont enrollment;</span>
        <span class="k">if</span> diagmonth - <span class="nv">&amp;HMOmonthpre.</span> &lt;= <span class="m">0</span> <span class="k">then</span> <span class="k">do</span>;
            eHMO_pre = <span class="m">0</span>;
        <span class="k">end</span>;
    <span class="k">end</span>;

    <span class="cm">/*****************</span>
<span class="cm">     *  After-Check  *</span>
<span class="cm">     *****************/</span>

<span class="c">    * If event after end, set all indicators to 0;</span>
    <span class="k">if</span> (<span class="nb">year(</span><span class="nv">&amp;dtvar.</span>) &gt; <span class="nv">&amp;end.</span>) <span class="k">or</span> (<span class="nb">year(</span><span class="nv">&amp;dtvar.</span>) &lt; <span class="nv">&amp;start.</span>)
        <span class="k">then</span> <span class="k">do</span>;
        eHMO_post = <span class="m">0</span>;
        eFFS_post = <span class="m">0</span>;
        <span class="k">end</span>;
    <span class="k">else</span> <span class="k">do</span>;
<span class="c">        * Otherwise start the loop for months post;</span>
        eHMO_post = <span class="m">1</span>;
        eFFS_post = <span class="m">1</span>;

<span class="c">        * Calculate the number of months over which to Examine enrollment;</span>
<span class="c">        * In particular, do not search after death;</span>
        <span class="k">if</span> (sdod ne .) <span class="k">then</span> deathmonth = (<span class="nb">year(</span>sdod) - <span class="nv">&amp;start.</span>) * <span class="m">12</span> + <span class="nb">month(</span>sdod);

<span class="c">        * Special case 1: Individuals who died the year they had indx event;</span>
<span class="c">        * -----------------------------------------------------------------;</span>

        <span class="k">if</span> (sdod ne .) <span class="k">and</span>
            ((deathmonth &gt;= diagmonth) <span class="k">and</span> (deathmonth - diagmonth &lt; <span class="nv">&amp;FFSmonthpost.</span>)) <span class="k">then</span> <span class="k">do</span>;
            monthsAheadFFS = deathmonth - diagmonth;
        <span class="k">end</span>;
        <span class="k">else</span> <span class="k">do</span>;
            monthsAheadFFS = <span class="nv">&amp;FFSmonthpost.</span>;
        <span class="k">end</span>;

        <span class="k">if</span> (sdod ne .) <span class="k">and</span>
            ((deathmonth &gt;= diagmonth) <span class="k">and</span> (deathmonth - diagmonth &lt; <span class="nv">&amp;HMOmonthpost.</span>)) <span class="k">then</span> <span class="k">do</span>;
            monthsAheadHMO = deathmonth - diagmonth;
            <span class="k">end</span>;
        <span class="k">else</span> <span class="k">do</span>;
            monthsAheadHMO = <span class="nv">&amp;HMOmonthpost.</span>;
        <span class="k">end</span>;

<span class="c">        * Special case 2: Possible to check enrolment given window and start end year;</span>
<span class="c">        * ---------------------------------------------------------------------------;</span>

        <span class="k">if</span> diagmonth + monthsAheadFFS &lt;= (<span class="nv">&amp;end.</span> - <span class="nv">&amp;start.</span> + <span class="m">1</span>) * <span class="m">12</span> <span class="k">then</span> <span class="k">do</span>;
            <span class="k">do</span> m = diagmonth to (diagmonth + monthsAheadFFS);
                eFFS_post = eFFS_post <span class="k">and</span> (affs(m) = <span class="s">&quot;3&quot;</span> <span class="k">or</span> affs(m) = <span class="s">&quot;C&quot;</span>);
            <span class="k">end</span>;
        <span class="k">end</span>;
        <span class="k">if</span> diagmonth + monthsAheadHMO &lt;= (<span class="nv">&amp;end.</span>-<span class="nv">&amp;start.</span> + <span class="m">1</span>) * <span class="m">12</span> <span class="k">then</span> <span class="k">do</span>;
            <span class="k">do</span> m = diagmonth to (diagmonth + monthsAheadHMO);
                eHMO_post = eHMO_post <span class="k">and</span> (ahmo(m) = <span class="s">&quot;0&quot;</span> <span class="k">or</span> ahmo(m) = <span class="s">&quot;4&quot;</span>);
            <span class="k">end</span>;
        <span class="k">end</span>;

<span class="c">        * Special case 3: Not possible to check window - assume no enrollment;</span>
<span class="c">        * -------------------------------------------------------------------;</span>

<span class="c">        * Includes individuals falling outside study window, for example because;</span>
<span class="c">        * of errant coding. Also ignore individuals who died within X months of;</span>
<span class="c">        * the end point of the study because its impossible for them to have X;</span>
<span class="c">        * months of post enrollment - because the study period ends;</span>
        <span class="cm">/*;</span>
<span class="cm">        if (diagmonth + monthsAheadFFS &gt; (&amp;end. - &amp;start. + 1) * 12) or</span>
<span class="cm">           (diagmonth + &amp;FFSmonthpost. &gt; (&amp;end. - &amp;start. + 1) * 12) then do;</span>
<span class="cm">            eFFS_post = 0;</span>
<span class="cm">        end;</span>

<span class="cm">        if (diagmonth + monthsAheadHMO &gt; (&amp;end. - &amp;start. + 1 ) * 12) or</span>
<span class="cm">           (diagmonth + &amp;HMOmonthpost. &gt; (&amp;end. - &amp;start. + 1 ) * 12) then do;</span>
<span class="cm">            eHMO_post = 0;</span>
<span class="cm">        end;</span>
<span class="cm">        */</span>;
    <span class="k">end</span>;
    <span class="k">drop</span> <span class="nf">%genYM</span>(buyin,  <span class="nv">&amp;start.</span>, <span class="nv">&amp;end.</span>, month) <span class="nf">%genYM</span>(hmoind, <span class="nv">&amp;start.</span>, <span class="nv">&amp;end.</span>, month);
<span class="nb">%mend</span> generateEnrollRest;

<span class="nb">%macro</span> genYM(prefix, dstart, dend, <span class="k">by</span>);
    <span class="nb">%let</span> s = <span class="nb">%sysfunc</span>(<span class="nb">intnx(</span><span class="nv">&amp;by</span>, <span class="nb">%sysfunc</span>(<span class="nb">inputn(</span>01JAN<span class="nv">&amp;dstart</span>, date9.)), <span class="m">0</span>, e));
    <span class="nb">%let</span> e = <span class="nb">%sysfunc</span>(<span class="nb">intnx(</span><span class="nv">&amp;by</span>, <span class="nb">%sysfunc</span>(<span class="nb">inputn(</span>31DEC<span class="nv">&amp;dend</span>,   date9.)), <span class="m">0</span>, e));
    <span class="nb">%do</span> <span class="nb">%while</span> (<span class="nb">%sysfunc</span>(<span class="nb">intck(</span><span class="nv">&amp;by</span>, <span class="nv">&amp;s</span>, <span class="nv">&amp;e</span>)) gt -<span class="m">1</span>);
        <span class="nv">&amp;prefix.</span><span class="nb">%sysfunc</span>(<span class="nb">year(</span><span class="nv">&amp;s</span>))m<span class="nb">%sysfunc</span>(<span class="nb">month(</span><span class="nv">&amp;s</span>))
        <span class="nb">%let</span> s = <span class="nb">%sysfunc</span>(<span class="nb">intnx(</span><span class="nv">&amp;by</span>, <span class="nv">&amp;s</span>, <span class="m">1</span>, e));
    <span class="nb">%end</span>;
<span class="nb">%mend</span>;
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../kyle/using-tmux-aging-servers/" title="Using tmux for long-running jobs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Using tmux for long-running jobs
              </span>
            </div>
          </a>
        
        
          <a href="../lag-post-event-spending/" title="Calculating Costs for Inpatient Visits" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Calculating Costs for Inpatient Visits
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9fb73e57.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
        <script src="../../js/helpers.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
    
      
    
  </body>
</html>